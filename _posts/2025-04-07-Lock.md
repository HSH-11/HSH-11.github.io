---
layout: post
title:  "공유 락과 배타 락"
tag: [DataBase, MySQL, Interview]
description: 공유 락과 배타 락에 대한 인터뷰 질문
image: '/images/09-2.jpg'
tags_color: '#4643ec'
---


# 공유 락과 배타 락에 대해서 설명해주세요.

DBMS에서 트랜잭션을 특별한 제어 없이 병행 수행을 허용한다면 데이터의 일관성과 무결성을 보장하기 어려울 수 있습니다. 이때, 병행 수행되는 트랜잭션들을 제어하기 위해서 락을 사용할 수 있으며 DBMS에서 락은 크게 공유 락과 배타 락으로 분류할 수 있습니다.

**공유 락(Shared Lock)** 은 읽기 락(Read Lock)이라고 부르며, 공유 락이 걸린 데이터에 대해서 다른 트랜잭션에서도 공유 락을 획득할 수 있지만, 배타 락은 획득할 수 없습니다. 즉, 공유 락을 사용하면 트랜잭션 내에서 조회한 데이터가 변경되지 않는다는 것을 보장합니다.

```sql
SELECT * FROM table_name WHERE id = 1 FOR SHARE;
```

**배타 락(Exclusive Lock)** 은 쓰기 락(Write Lock)이라고 부르며, 배타 락이 걸린 데이터에 대해서 다른 트랜잭션에서는 공유 락과 배타 락을 획득할 수 없습니다. 즉, 배타 락을 획득한 트랜잭션은 데이터에 대한 독점권을 가집니다.

```sql
SELECT * FROM table_name WHERE id = 1 FOR UPDATE;
```

정리하자면, 공유 락이 걸린 데이터는 다른 트랜잭션에서 공유 락을 획득 할 수 있고, 배타 락이 걸린 데이터는 다른 트랜잭션에서 어떤 종류의 락도 획득할 수 없어서 대기하는 상황이 발생할 수 있습니다.

## 데드 락은 언제 발생하며 어떻게 해결할 수 있나요? 🤔

**데드 락(Dead Lock)** 이란 교착 상태로, 두개 이상의 트랜잭션이 서로 필요로 하는 데이터의 락을 점유하고 있어서 무한히 대기하는 상황을 말합니다. 트랜잭션은 락을 획득하지 못하는 경우, 다른 트랜잭션이 점유하고 있는 락이 해제될 때까지 대기합니다. 예를 들어, 다음과 같은 트랜잭션들이 존재한다고 가정하겠습니다.

```
초기 상황: id=1, id=2 데이터 존재

트랜잭션 A 시작
  - id=1 읽기 → 공유 락 획득
트랜잭션 B 시작
  - id=2 읽기 → 공유 락 획득

트랜잭션 A
  - id=2 쓰기 시도 → 배타 락 요청 → B가 공유 락 보유 중 → 대기

트랜잭션 B
  - id=1 쓰기 시도 → 배타 락 요청 → A가 공유 락 보유 중 → 대기

→ A와 B가 서로 상대방의 락 해제를 기다리는 상태 → 데드락 발생

```

### 해결 방법

1. **락 획득 순서 고정**: 항상 `id=1` → `id=2` 순서로 락을 걸도록 강제
2. **타임아웃 설정**: 일정 시간 대기 후 트랜잭션 중 하나를 롤백
